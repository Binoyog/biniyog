<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Tasks</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#87CEEB;
}
.header{
    background:#0288d1;
    color:#fff;
    text-align:center;
    padding:15px;
    font-size:22px;
}
.plan-card{
    background:#fff;
    margin:15px;
    padding:18px;
    border-radius:14px;
    box-shadow:0 2px 8px rgba(0,0,0,0.2);
}
.plan-card h3{
    margin:0 0 10px;
    color:#0288d1;
}
.balance{
    font-weight:bold;
    color:green;
}
.completed{
    color:red;
    font-weight:bold;
}
</style>
</head>

<body>

<div class="header">üìã My Plans (Task)</div>

<div id="taskBox"></div>

<script>
let balance = Number(localStorage.getItem("balance")) || 0;
let plans = JSON.parse(localStorage.getItem("activePlans")) || [];
let today = new Date().toDateString();

function save(){
    localStorage.setItem("balance", balance);
    localStorage.setItem("activePlans", JSON.stringify(plans));
}

function processPlans(){

    let html = "";

    if(plans.length === 0){
        document.getElementById("taskBox").innerHTML = "‚ùå ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶≤‡¶æ‡¶® ‡¶ï‡ßá‡¶®‡¶æ ‡¶π‡ßü‡¶®‡¶ø";
        return;
    }

    plans.forEach((plan, index)=>{
        let buyDate = new Date(plan.buyDate);
        let endDate = new Date(plan.endDate);
        let now = new Date();

        /* üî¥ PLAN FINISHED */
        if(now > endDate && !plan.completed){
            balance += plan.price;
            balance += plan.dailyIncome;
            plan.completed = true;
            save();
        }

        /* üü¢ DAILY INCOME */
        if(!plan.completed && plan.lastPaid !== today){
            balance += plan.dailyIncome;
            plan.lastPaid = today;
            save();
        }

        html += `
        <div class="plan-card">
            <h3>${plan.name}</h3>
            <p>üí∞ ‡¶¨‡¶ø‡¶®‡¶ø‡ßü‡ßã‡¶ó: ‡ß≥${plan.price}</p>
            <p>üìÖ ‡¶ï‡ßá‡¶®‡¶æ: ${buyDate.toLocaleDateString()}</p>
            <p>‚è≥ ‡¶∂‡ßá‡¶∑: ${endDate.toLocaleDateString()}</p>
            <p>üìà ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶Ü‡ßü: ‡ß≥${plan.dailyIncome}</p>
            ${
                plan.completed
                ? `<p class="completed">‚úÖ ‡¶™‡ßç‡¶≤‡¶æ‡¶® ‡¶∂‡ßá‡¶∑</p>`
                : `<p class="balance">‡¶ö‡¶≤‡¶Æ‡¶æ‡¶®</p>`
            }
        </div>`;
    });

    html += `
    <div class="plan-card">
        <h3>üîê Total Balance</h3>
        <p class="balance">‡ß≥${balance}</p>
    </div>
    `;

    document.getElementById("taskBox").innerHTML = html;
}

processPlans();
</script>

</body>
</html>
